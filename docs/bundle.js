!function(e){function t(n){if(i[n])return i[n].exports;var a=i[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,t),a.l=!0,a.exports}var i={};t.m=e,t.c=i,t.d=function(e,i,n){t.o(e,i)||Object.defineProperty(e,i,{configurable:!1,enumerable:!0,get:n})},t.n=function(e){var i=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(i,"a",i),i},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p="",t(t.s=0)}([function(e,t,i){i(1).init()},function(e,t,i){"use strict";e.exports={config:{apiKey:"AIzaSyA8LOCns8rR3236Llz2Jab1KPZdj4sV_bo",authDomain:"ettan2017-8240b.firebaseapp.com",databaseURL:"https://ettan2017-8240b.firebaseio.com",projectId:"ettan2017-8240b",storageBucket:"",messagingSenderId:"450005891534"},dbRefPath:"ettan2017/",userNameFontSize:1,imageSize:window.innerWidth,imageX:0,imageY:0,imageScale:1,tapEnabled:!1,userParam:{uid:null,id:null,name:null,icon:null},init:function(){firebase.initializeApp(this.config),window.onload=function(){this.didLoad()}.bind(this)},didLoad:function(){this.fadeOut(),this.fxxkinApple(),document.getElementById("login").addEventListener("click",function(e){e.stopPropagation(),this.tapEnabled=!1,this.onLogin()}.bind(this)),document.getElementById("logout").addEventListener("click",function(e){e.stopPropagation(),this.tapEnabled=!1,this.onLogout()}.bind(this)),document.getElementById("remove").addEventListener("click",function(e){e.stopPropagation(),this.tapEnabled=!1,this.onRemove()}.bind(this)),window.addEventListener("resize",function(e){this.onResize()}.bind(this));var e=d3.behavior.zoom();e.scale(1),e.scaleExtent([1,10]),e.on("zoom",function(){this.tapEnabled=!1,this.onZoom()}.bind(this));var t=d3.select("body");t.call(e),t.on("click",function(){this.tapEnabled=!1,this.onClick(d3.event.clientX,d3.event.clientY)}.bind(this)),t.on("touchstart",function(){this.tapEnabled=!0}.bind(this)),t.on("touchend",function(){var e=d3.event.pageX,t=d3.event.pageY;setTimeout(function(){this.tapEnabled&&this.onClick(e,t)}.bind(this),200)}.bind(this)),this.setImagePosition(0,0,1),firebase.database().ref(this.dbRefPath).once("value").then(function(e){var t=e.val();t&&(document.getElementById("numErenists").innerText=Object.keys(t).length,Object.keys(t).forEach(function(e){var i=t[e];this.addUserTag(e,i.icon,i.name,i.id,i.x,i.y)}.bind(this)))}.bind(this)),firebase.auth().getRedirectResult().then(function(e){this.userParam.id=e.additionalUserInfo.username,this.userParam.name=e.user.displayName,this.userParam.icon=e.user.photoURL,this.userParam.uid=e.user.uid,this.didLogin(),this.fadeIn()}.bind(this)).catch(function(e){this.didLogout();var t=document.getElementById("description");t.style.pointerEvents="auto",t.style.opacity=1,document.getElementById("start").addEventListener("click",function(e){return t.style.pointerEvents="none",t.style.opacity=0,!1}.bind(this)),this.fadeIn()}.bind(this))},onResize:function(){this.imageSize=window.innerWidth},onZoom:function(){this.setImagePosition(d3.event.translate[0],d3.event.translate[1],d3.event.scale)},onClick:function(e,t){if(this.userParam.uid){var i=(e-this.imageX)/(this.imageSize*this.imageScale),n=(t-this.imageY)/(this.imageSize*this.imageScale);this.removeUserTag(this.userParam.uid),this.addUserTag(this.userParam.uid,this.userParam.icon,this.userParam.name,this.userParam.id,i,n),firebase.database().ref(this.dbRefPath+this.userParam.uid).set({id:this.userParam.id,name:this.userParam.name,icon:this.userParam.icon,x:i,y:n})}},onRemove:function(){this.userParam.uid&&window.confirm("„Åà„Å£ÔºüÂâäÈô§„Åó„Åæ„Åô„ÅãÔºüüò£")&&(this.removeUserTag(this.userParam.uid),firebase.database().ref(this.dbRefPath+this.userParam.uid).set(null))},addUserTag:function(e,t,i,n,a,s){var o=document.createElement("div");o.className="userName",o.id=e,o.innerText=i,o.style.left=100*a+"%",o.style.top=100*s+"%";var d=document.createElement("img");d.className="userIcon",d.id=e,d.src=t,d.alt=n,d.style.right=100*(1-a)+"%",d.style.top=100*s+"%",d.addEventListener("click",function(e){this.userParam.uid||(e.stopPropagation(),this.openTwitter(e.currentTarget.alt))}.bind(this));var r=document.getElementById("imageContainer");r.appendChild(d),r.appendChild(o)},openTwitter:function(e){window.open("https://twitter.com/"+e)},removeUserTag:function(e){var t=document.getElementById(e);t&&(t.parentNode.removeChild(t),this.removeUserTag(e))},setImagePosition:function(e,t,i){this.imageX=e,this.imageY=t,this.imageScale=i,this.updateImagePosition()},updateImagePosition:function(){var e=document.getElementById("imageContainer");e.style.left=this.imageX/this.imageSize*100+"vw",e.style.top=this.imageY/this.imageSize*100+"vw",e.style.width=100*this.imageScale+"vw",e.style.height=100*this.imageScale+"vw",e.style.fontSize=this.imageScale*this.userNameFontSize+"vw"},onLogin:function(){var e=new firebase.auth.TwitterAuthProvider;e.setCustomParameters({lang:"ja"}),firebase.auth().signInWithRedirect(e)},didLogin:function(){document.getElementById("login").style.display="none",document.getElementById("logout").style.display="inline",document.getElementById("remove").style.display="inline";var e=document.getElementById("icon");e.src=this.userParam.icon,e.hidden=!1,document.getElementById("name").innerText=this.userParam.name},onLogout:function(){this.fadeOut(),firebase.auth().signOut().then(function(){this.userParam.id=null,this.userParam.name=null,this.userParam.icon=null,this.userParam.uid=null,this.didLogout(),this.fadeIn()}.bind(this)).catch(function(e){window.alert("„É≠„Ç∞„Ç¢„Ç¶„Éà„Å´Â§±Êïó„Åó„Åæ„Åó„Åü"),this.fadeIn()}.bind(this))},didLogout:function(){document.getElementById("login").style.display="inline",document.getElementById("logout").style.display="none",document.getElementById("remove").style.display="none";var e=document.getElementById("icon");e.src="",e.hidden=!0,document.getElementById("name").innerText=""},fadeIn:function(){document.body.style.opacity=1,document.getElementById("progress").style.opacity=0},fadeOut:function(){document.body.style.opacity=1,document.getElementById("progress").style.opacity=.7},fxxkinApple:function(){document.addEventListener("touchstart",function(e){"button"!==e.target.className&&"userIcon"!==e.target.className&&e.preventDefault()},!0),document.addEventListener("touchmove",function(e){e.preventDefault()},!0)}}}]);
//# sourceMappingURL=bundle.js.map